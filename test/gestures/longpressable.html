<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver@1.1.2/observeElementCreation.js"></script>
<script src="../../src/customAttributes.js"></script>
<script src="../../src/GestureAttr.js"></script>

<div longpress:console.log_e.type_e.target.tag-name>
  <h1 longpressable_200>hello longpress</h1>
</div>

<script>
  customAttributes.define("timeout", class TimeoutAttr extends CustomAttr {
    upgrade() {
      this._timer = setTimeout(() => eventLoop.dispatch(new Event(this.type), this), this.suffix[0]);
    }
  });

  function newEvent(e, prefix) {
    eventLoop.dispatch(new Event(prefix), this.ownerElement);
    return e;
  }

  customReactions.define("on-mouse-move", function (e, _, arg1, arg2) {
    console.log(arg1, arg2);
  });

  customReactions.define("longpress", newEvent);
  customReactions.define("longpress-reset", newEvent);
  customAttributes.define("longpressable", class LongPress extends GestureAttr {

    static stateMachine(time = 200) {
      return {
        start: [
          ["mousedown", "observe"]
        ],
        observe: [
          ["_mousedown", "start"],
          ["_mousemove:on-mouse-move_mousemove_observe"],
          ["_mouseup", "start"],
          [`timeout_${time}`, "active"],
        ],
        active: [
          ["_mousedown::longpress-reset", "start"],
          ["_mousemove:on-mouse-move_mousemove_active"],
          ["_mouseup::longpress", "start"]//todo how to get duration here?
        ]
      };
    }
  });

  const h1 = document.querySelector("h1");
  h1.dispatchEvent(new MouseEvent("mousedown"));
  setTimeout(_ => h1.dispatchEvent(new MouseEvent("mousemove")), 0);
  setTimeout(_ => h1.dispatchEvent(new MouseEvent("mousemove", {bubbles: true})), 250);
  setTimeout(_ => h1.dispatchEvent(new MouseEvent("mouseup", {bubbles: true})), 300);
</script>