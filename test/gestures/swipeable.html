<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver@1.1.2/observeElementCreation.js"></script>
<script src="../../src/customAttributes.js"></script>
<script src="../../src/dotReaction.js"></script>
<script src="../../src/core.js"></script>
<script src="../../src/GestureAttrSimple.js"></script>

<body
    swipe:console.log_e.type_e.direction_e.length
    swipe-start:console.log_e.type
    swipe-cancel:console.log_e.type
>
<div swipeable_100></div>
</body>

<script>
  class SwipeEvent extends MouseEvent {
    constructor(type, dict, start) {
      super(type, dict);
      this.start = start;
      this.end = dict.x;
    }

    get direction() {
      //return ((Math.atan2(y, -x) * 180 / Math.PI) + 270) % 360;
      return this.end >= this.start ? "right" : "left";
    }

    get length() {
      return Math.abs(this.end - this.start);
    }
  }

  customReactions.define("event", (e, _, type) => new e.constructor(type, e));
  customAttributes.define("swipeable", class SwipeAttr extends GestureAttr {

    swipe(e) {
      return new SwipeEvent(this.type.slice(0, -4), e, this.data);
    }

    checkCancel(e) {
      return Math.abs(e.x - this.data[0]) < this.suffix[0] ?
        eventLoop.dispatch(new e.constructor("swipe-cancel", e), this.ownerElement) :
        e;
    }

    static stateMachine() {
      return {
        "": [["mousedown:.g.set_e.x:event_swipe-start:dispatch", "start"]],
        start: [
          [`_mouseup:g.check-cancel_e::g.swipe_e:dispatch`, ""],
          ["_blur:event_swipe-cancel:dispatch", ""],
          ["_selectstart:prevent", ""]
        ]
      };
    }
  });
  (function () {
    const div = document.querySelector("div");
    setTimeout(_ => div.dispatchEvent(new MouseEvent("mousedown", {clientX: 5})), 50);
    setTimeout(_ => document.body.dispatchEvent(new MouseEvent("mouseup", {bubbles: true, clientX: 350})), 100);
  })();
  setTimeout(function () {
    const div = document.querySelector("div");
    setTimeout(_ => div.dispatchEvent(new MouseEvent("mousedown", {clientX: 505})), 50);
    setTimeout(_ => document.body.dispatchEvent(new MouseEvent("mouseup", {bubbles: true, clientX: 150})), 100);
  }, 300);

</script>