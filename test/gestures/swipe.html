<style>
  #viewport {
    width: 450px;
    height: 450px;
    position: relative;
    overflow: hidden;
    background-color: yellow;
  }

  #viewport > div {
    width: 450px;
    height: 450px;
    background-color: red;
  }
</style>

<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver@1.1.2/observeElementCreation.js"></script>
<script src="../../src/customAttributes.js"></script>
<script src="../../src/GestureAttr.js"></script>

<div id="viewport" swipe-start:swipestart swipe-stop:swipestop>
  <div swipeable></div>
</div>

<script>
  let swipeStart = 0;

  customAttributes.define("swipeable", class SwipeAttr extends GestureAttr {
    static stateMachine() {
      return {
        "": [["mousedown:swipe_start", "start"]],
        start: [
          ["_mouseup:swipe_stop", ""],
          ["_blur:swipe_cancel", ""],
          ["_selectstart:prevent", ""]
        ]
      };
    }
  });

  customReactions.define("swipe", function (e, _, type) {
    eventLoop.dispatch(makeSwipeEvent(type, e), this.ownerElement);
    return e;
  });

  customReactions.define("prevent", e => (e.preventDefault(), e));

  customReactions.define("swipestart", e => swipeStart = e.x - e.target.offsetLeft);

  function makeSwipeEvent(type, {x, y}) {
    const composedEvent = new CustomEvent("swipe-" + type, {bubbles: true, composed: true});
    [composedEvent.x, composedEvent.y] = [x, y];
    return composedEvent;
  }

  const colorPicker = () => 'rgb(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ')';

  function swipeStop({x}) {
    const swipeDist = swipeStart - x;
    if (Math.abs(swipeDist) < 100) return;
    const viewport = this.ownerElement;
    const frame = viewport.firstElementChild;
    frame.style.transitionDuration = "0.8s";
    frame.style.transform = `rotate(${swipeDist > 0 ? "-" : ""}15deg)`;
    frame.style.marginLeft = (swipeDist > 0 ? "-" : "") + "650px";
    setTimeout(function () {
      frame.remove();
      const el = document.createElement("div");
      el.setAttribute("swipeable");
      el.style.backgroundColor = colorPicker();
      viewport.append(el);
    }, 500);
  }

  customReactions.define("swipestop", swipeStop);
</script>