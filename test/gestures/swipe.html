<style>
  #viewport {
    width: 450px;
    height: 450px;
    position: relative;
    overflow: hidden;
    background-color: yellow;
  }

  #viewport > div {
    width: 450px;
    height: 450px;
    background-color: red;
  }

  .right {
    transition: all 0.8s;
    transform: rotate(15deg);
    margin-left: 650px;
  }

  .left {
    transition: all 0.8s;
    transform: rotate(-15deg);
    margin-left: -650px;
  }
</style>

<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver@1.1.2/observeElementCreation.js"></script>
<script src="../../src/customAttributes.js"></script>
<script src="../../src/core.js"></script>
<script src="../../src/GestureAttr.js"></script>

<div id="viewport" swipe-start:swipestart swipe:swipestop:await2_500:replace>
  <div swipeable></div>
</div>

<script>
  let swipeStart = 0;

  customAttributes.define("swipeable", class SwipeAttr extends GestureAttr {
    static stateMachine() {
      return {
        "": [["mousedown:swipe_-start", "start"]],
        start: [
          ["_mouseup::swipe", ""],
          ["_blur:swipe_-cancel", ""],
          ["_selectstart:prevent", ""]
        ]
      };
    }
  });

  customReactions.define("swipe", function (e, prefix, type = "") {
    const copy = new e.constructor(prefix + type, e);
    eventLoop.dispatch(copy, this.ownerElement);
    return copy;
  });

  customReactions.define("prevent", e => (e.preventDefault(), e));
  customReactions.define("await2", async (e, _, num) => {
    if (num && isNaN(num))
      throw new SyntaxError(`${_}_${num} is illegal, the _${num} is not a number.`);
    await (num ? new Promise(r => setTimeout(r, num)) : Promise.resolve());
    return e;
  });

  customReactions.define("swipestart", e => ((swipeStart = e.x), e));

  customReactions.define("random-color", function randomColor() {
    return 'rgb(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ')';
  });

  customReactions.define("replace", function replaceElement() {
    this.ownerElement.innerHTML = "<div swipeable ready:random-color:this.owner-element.style.background-color_e></div>";
  });

  customReactions.define("swipestop", function swipeStop({x}) {
    const swipeDist = swipeStart - x;
    if (Math.abs(swipeDist) < 100)
      return;
    this.ownerElement.firstElementChild.classList.add(swipeDist > 0 ? "left" : "right");
    return x;
  });
</script>