<script src="../../src/customAttributes.js"></script>
<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver@1.1.0/startObserver.js"></script>
<script src="../../src/core.js"></script>

<body test:prop3_e3_time-stamp:stopwatch:call3_window3_-math_min_25:call3_window3_console_log>

<script>
  //todo a diff/aggregator of sorts. same as throttle. it joins the output of many different events across async time.
  const stopWatches = new WeakMap();
  customReactions.define("stopwatch", function stopwatch(timeStamp) {
    const lastTime = stopWatches.get(this) || timeStamp;
    stopWatches.set(this, timeStamp);
    return timeStamp - lastTime;
  });
  customReactions.define("dispatch", function dispatch(e, _, type) {
    const e2 = e instanceof Event ? new e.constructor(type, e) : new CustomEvent(type, {detail: e});
    eventLoop.dispatch(e2, this.ownerElement);
    return e2;
  });
</script>

<h1
    ready:new3_-event_test:new3_-array:push3_el3:apply3_window3_event-loop_dispatch
    timeout_50:dispatch_test
    timeout_100:dispatch_test>hello sunshine</h1>
</body>